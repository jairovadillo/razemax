language: python
python:
- "3.6"

env:
- DOCKER_COMPOSE_VERSION=1.23.2

before_install:
- sudo rm /usr/local/bin/docker-compose
- curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
- chmod +x docker-compose
- sudo mv docker-compose /usr/local/bin

stages:
  - test
  - deploy

script:
- make unit-tests
- make integration-tests

deploy:
  provider: pypi
  user: "21buttons"
  server: https://upload.pypi.org/legacy/
  password:
    secure: AynaGwVi0fsL+2wQbp9jHQqtYAKvn9YOtpgWMrnJd0ByB/LEKnLpzk7Y0CPsmGkvzcgSn/FJI6orOaxHuL4edzryYc/AeyRbASgj4oibBnijw/qoWcXQJjYC2//W4S6cb9CxsVUryErRtLLSzVLteyytpaQafqy/cJYr/0xvlLt16nqyPWrq5/pzj1Hv97G03e7Tfdl1v+yGnYrQiB+9KbFRRwYK4sVSeVJlYCxlYNExb+aDaKqY2LZEc25xDh9FYQmMBnCbVu/uDljQzB/K0WnSrpuRvrN2FadkNdTUJbYO0jqbtBaHZGhx94iqjPhNkgh6A9RgG/sxd8+7bLT9FL0YP/3lPYZjas3owLiYM3duKcAmZNIYtGYvyUxMVxGFRWMorCM0+QPbJugUZgkhcQfnhP6ImavU3QjV5MVbFmWCPYo85P+kNSB+u28JK3AbfjzAJ17mzEquYdbnePwNtW+CLQiySFAIIAQvs0fM5jyq6NIxcr6BZuTHQWhaYBOaqyIR1/tdVBFb81WeqFzxQhiW+tOLlalaX83O7waVPJdgWyCT00KZ+6dE1IY+kdhUDIJMI/EPYCHdGOv3Dyn2KLVrvpCwhKrnjezh+fslFX5e/mV6i/kIVk51ObgV5WPAAOAnVbF/Jdi7Ighl1cV7yGm2akS2dhlzG2RnJBzpR6w=
  on:
    tags: true

jobs:
  include:
  - stage: test
    name: Unit Tests
    script: make unit-tests
  - name: Integration Tests
    script: make integration-tests
